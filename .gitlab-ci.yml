# Adding a comment cuz
image: python:3.5

variables: 
    GIT_STRATEGY: fetch
    GIT_SUBMODULE_STRATEGY: none

before_script:
    - python -V
    - pip install pipenv
    - pipenv install --dev

stages:
    - build
    - test
    - deploy
    - release

setup:
    stage: build
    script:
        - python setup.py sdist
    artifacts:
        paths:
            - dist/
    only:
        - master

pytest:
    stage: test
    script:
        - python -m pytest --ignore=autogen-api-commands -vvv

staging:
    stage: deploy
    dependencies:
        - setup
    script:
        # TODO update version
        - twine upload --repository-url https://push.fury.io/sphero -u TOKEN -p "" dist/*
    only:
        - web
        - master

production:
    stage: release
    dependencies:
        - setup
    script:
        - python -V
        # TODO upload to PyPI
    only:
        - web
