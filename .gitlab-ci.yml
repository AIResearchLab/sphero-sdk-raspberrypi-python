# Adding a comment cuz
image: python:3.5

variables: 
    GIT_STRATEGY: fetch
    GIT_SUBMODULE_STRATEGY: none
    PIP_CACHE_DIR: "~/.cache/pip"
    PIPENV_VENV_IN_PROJECT: true

cache:
  paths:
    - .cache/pip
    - .venv
before_script:
    - python -V
    - pip install twine
    - pip install pipenv
    - pipenv install --dev --skip-lock

stages:
    - build
    - test
    - deploy
    - release

setup:
    stage: build
    script:
        - python setup.py sdist
        - ls -al

    artifacts:
        paths:
            - dist/
    only:
        - master

pytest:
    stage: test
    script:
        - pipenv run python -m pytest --ignore=autogen-api-commands -vvv

staging:
    stage: deploy
    dependencies:
        - setup
    script:
        # TODO update version
        - twine upload --repository-url https://push.fury.io/sphero -p "" dist/*
    when: manual
    only:
        - web
        - master

production:
    stage: release
    dependencies:
        - setup
    script:
        - python -V
        # TODO upload to PyPI
    when: manual
    only:
        - web
